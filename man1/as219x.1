.\" groff -man as219x.1
.TH "as219x" 1 "January 23, 2005"

.SH NAME
as219x \- Assembler for the Analog Devices 219X DSP. 

.SH SYNOPSIS
.in +7
.ti -7
.B as219x
.RB [ \-v ]
.ti -7
.B as219x
.RB [ \-2
.IR processor ]
.RB [ \-d " ["\c
.IR aplv "]] ["\c
.BI \-D
.I macro\c
.RI [ =definition "]] ["\c
.BI \-E " max-errors"\c
.RB "] [" \-I
.IR include-dir "] ["\c
.BI \-l " list-file"\c
.RB "] [" \-o
.IR output ] " files"
.RB "..."
.in -7

.SH DESCRIPTION
As219x assembles one or more text source files written using
the Analog Devices 219X syntax into an ELF object file (a.out
unless modified by the -o option) which can be linked using
.BR ld21 (1).
For information on assembler syntax, refer to the Analog
Device document
.BR "Visual DSP++ 3.5 Assembler and Preprocessor Manual for ADSP-218x and ADSP-219x Family DSPs" \.
For information on ADSP-219X mnemonics refer to
.B ADSP-219x DSP Instruction Set Reference.
At the time of writing this documentation, both of these manuals
could be downloaded from the Analog Devices web site at
.BR "http://www.analog.com" .
.sp
Analog Devices made a significant syntax change between versions
6\.x and 7.x of their tools.
.BR As218x "(1), " as219x ", and " ld21 (1)
follow the version 7.x and later syntax.
.sp
.B As219x
does not support all of the command line options provided by
the Analog Devices tools and some of the options provided have no
counterpart in the Analog Devices assembler. When in doubt, refer
to this page for option usage.
.sp
The result of running 
.B as219x
on a source file is an ELF object file. The generated object files
are not in any way compatible with those generated by the Analog
Devices tools and therefore cannot be linked with files generated by
those tools.
.sp
The object files are standard ELF files and as such can be viewed with
any ELF viewer. However,
.BR elfdump (1),
included with this tool set has special knowledge about files generated
by 
.BR as218x "(1), " as219x ", and " ld21 (1)
and so can be more useful for looking at the generated object files.
.sp
Once you\'ve assembled one or more files, they can be linked into an
executable using
.BR ld21 "(1)\. " Ez21 (1)
can be used to download the resulting executable via UART boot mode
to a 219x processor.
.SH OPTIONS
When assembling multiple files, command line switchs apply to the
next file encountered on the command line and the assembler state
is reset to the default state after each assembly.
.TP
.BI \-2 " processor"
Select the processor type. Available processors are: 191, 192,
195, and 196.
.TP
.BI \-d " aplv"
Turn on debugging output.
.I a
turns on yacc debug output for the assembler.
.I p
turns on yacc debug output for the preprocessor.
.I l
turns on flex debug output for the lexer.
.I v
sets a number of options which produce an assembler listing
to be used by verify21.
.IR "a p" " and " l
are only available when compiled in by building with "make DEBUG=1".
.TP
.BI \-D " macro=" [ definition ]
Define a macro to be used while assembling the program.
.TP
.BI  \-E " max-errors"
Set the maximum number of errors to allow during assembly.
.TP
.BI \-I " include-dir"
Specify an include directory to search for include files.
Directories included with this option are searched in the
order they are specified on the command line.

$OPEN21XXDIR/include, if it exists, is searched first by
#include <> directives.

.TP
.BI \-l " list-file"
Generate an assembler listing, writing it to the specified
file.
.TP
.BI \-o " output"
Change the output object file name from a.out to the
specified file name.
.TP
.B \-v
Print
.BR as219x "\'s version information."

.SH PREPROCESSOR
The
.B as219x
preprocessor uses the standard C preprocessor syntax. Preprocessor
directives are indicated by a 
.B #
as the first non-whitespace character on a line and continue
up to the end of the line.
.sp
The following preprocess directives are supported:
.BR #define ", " #if ", " #ifdef ", " #ifndef ", " #elif ", "
.BR #else ", " #endif ", " #error ", " #include ", " #line ", "
.BR #undef ", and " #warning .
Note that only the arguments for the
.BR #ifdef ", " #ifndef ", and " #undef
preprocess directives are
.B not
macro expanded. In addition to its normal behaviour, the 
.B #line
directive with no arguments causes error reporting to revert to using
the actual line number and file name.
.sp
When appearing in a preprocessor conditional directive, the expression
.BI defined( symbol )
or
.BI defined " symbol"
are evaluated to 1 if the symbol is defined in the preprocessor or 0 if
not.
.sp
When
.B #
prefixs a macro parameter name during macro expansion the 
.B # 
and parameter name are macro expanded and replaced by the double quoted
result. Any double quotes appearing in the expansion will be be escaped
with a \'\\\'.  After parameter substitution, during macro expansion, when
.B ##
is encountered, it and any surrounding white space are deleted so as to
create a new token out of the adjacent tokens.

.SH DIAGNOSTICS
.B As219x
generates a number of warning and error messages to standard error.
If no errors are encountered during assembly, an object file will be
generated. Warnings do not prevent object file generation.
.sp
Warnings and errors follow the gcc format. An error is displayed as:
.sp
.RS
.BR file : line : column : " message"
.RE
.sp
and a warning is displayed as:
.sp
.RS
.BR file : line : column : " warning: message"
.RE
.sp
Where:
.br
.RS
.TP
.BR file : line : column :
is the location where the problem occurred, possibly modified
by a #line directive.
.TP
.B message
is a text description of the problem.
.RE
.sp
.B NOTE:
The column number counts tabs as a single character, so if a line
contains tabs, the column number from the message won\'t match the
column as displayed in an editor.

.SH ENVIRONMENT VARIABLES
.TP
OPEN21XXDIR
Points to a directory which may contain an include directory that is
searched by #include <> before the other include directories are
searched.  The default installation directory is:
.ti +5
/usr/local/share
.br
in which case set OPEN21XXDIR to:
.ti +5
/usr/local/share/open21xx.
.br
Refer to the man page for your shell for instructions on setting and
exporting environment variables.

.SH CONVERTING LEGACY FILES
Its relatively easy to convert assembler files from pre 7\.x syntax
to 7\.x syntax and later. The following notes describe how to convert
most simple programs. For more detailed information on converting
assembler source files, see the 
.BR "Visual DSP++ 3.5 Assembler and Preprocessor Manual for ADSP-218x and ADSP-219x Family DSPs" \.
Follow the steps in the order given.
.TP
.B 1\.
Remove the \.module and \.endmod directives.
.TP
.B 2\.
Replace all opening brackets "{" with an opening C style
comment "/*" and replace all closing brackets "}" with a closing C style
comment "*/".
.TP
.B 3\.
Replace each instance of the \.const directive with a #define by
replacing "\.const" with "#define" and removing the "=" and the ";".
.TP
.B 4\.
Place a "\.section/dm data0;" statement before any group of "\.var/dm"
directives and remove all but the "/circ" flag from the directives.
Place a "\.section/pm program0;" statement before any group of "\.var/pm"
directives and remove all but the "/circ" flag from the directives.
.TP
.B 5\.
Move all "\.init" commands to immediately after their corresponding "\.var"
commands. Replace the ";" in the "\.var" command with an "=". Replace
the "\.init var_name:"
with "{" and place a "}" immediately before the terminating ";"
of the "\.init" command.
.TP
.B 6\.
Place a "\.section/pm interrupts;" in before the interrupt vector table.
.TP
.B 7\.
Place a "\.section/pm program0;" before any remaining program sections.
.TP
.B 8\.
Remove all address of operators "^", and replace all length of operators
"%", with the "LENGTH()" operator.

.SH UNSUPPORTED FEATURES
The /ABS qualifier is not supported. Absolute placement is accomplished
in the linker.

.SH KNOWN BUGS
A syntax error results from trying to assemble an empty source file
or a source file with only preprocessor commands.

A macro can\'t be defined with the same name as a program symbol
and visa versa which means you can\'t write a recursive macro
definition which will work.

The .FILE directive is tolerated but not supported. Use -o on the command
line.

.SH AUTHOR
Written by Keith Clifford:
.br
email: <sharpshinwm@telus.net>
.br
web:   http://www3.telus.net/sharpshin

.SH REPORTING BUGS
Report bugs to <sharpshinwm@telus.net>.

.SH COPYRIGHT
Copyright\(co 2002 Free Software Foundation, Inc. This is
free software; see the source for copying  conditions.
There is NO warranty; not even for MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.

.SH "SEE ALSO"
.BR as218x "(1), " elfdump "(1), " ez21 "(1), " ld21 "(1), " verify21 (1).

Note: elfdump and verify21 are primarily useful for debugging
the tools themselves so are not installed.

